<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular-route.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin: 20px;
            min-height: calc(100vh - 40px);
        }
        
        .navbar {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 20px rgba(33, 150, 243, 0.3);
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5em;
            color: white !important;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: white !important;
            transform: translateY(-2px);
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            margin-top: 10%;
            animation: fadeInUp 0.6s ease-out;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(33, 150, 243, 0.4);
            background: linear-gradient(45deg, #1976D2, #03A9F4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            border: none;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .btn-info {
            background: linear-gradient(45deg, #00BCD4, #26C6DA);
            border: none;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .form-control {
            border: 2px solid rgba(33, 150, 243, 0.1);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .form-control:focus {
            border-color: #2196F3;
            box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25);
            background: white;
        }
        
        .badge {
            border-radius: 10px;
            padding: 8px 12px;
            font-weight: 500;
        }
        
        .badge-success {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
        }
        
        .badge-info {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
        }
        
        .badge-warning {
            background: linear-gradient(45deg, #FF9800, #FFB74D);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .doctor-card {
            background: linear-gradient(145deg, #f0f0f0, #ffffff);
            transition: all 0.3s ease;
        }
        
        .doctor-card:hover {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
        }
        
        .alert {
            border: none;
            border-radius: 15px;
            animation: fadeInUp 0.4s ease-out;
        }
        
        .table {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .table thead th {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            border: none;
            padding: 20px 15px;
            font-weight: 600;
        }
        
        .table tbody tr {
            transition: all 0.3s ease;
        }
        
        .table tbody tr:hover {
            background: rgba(33, 150, 243, 0.05);
            transform: translateX(5px);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Home Page Styles */
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }
        
        .hero-overlay {
            background: rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
        }
        
        .hero-content {
            color: white;
            animation: fadeInUp 1s ease-out;
        }
        
        .hero-buttons .btn {
            margin: 0 10px 10px 0;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .hero-buttons .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .floating-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            animation: float 3s ease-in-out infinite;
            margin: 50px;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .stats-section {
            background: rgba(255, 255, 255, 0.95);
            margin: -50px 0 0 0;
            position: relative;
            z-index: 3;
        }
        
        .stat-card {
            background: white;
            padding: 40px 20px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            animation: fadeInUp 0.8s ease-out;
        }
        
        .stat-card:hover {
            transform: translateY(-10px);
        }
        
        .stat-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }
        
        .stat-number {
            font-size: 3em;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1.1em;
            margin: 0;
        }
        
        .services-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .section-title {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
        
        .section-subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 50px;
        }
        
        .service-card {
            background: white;
            padding: 40px 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            height: 100%;
            animation: fadeInUp 0.9s ease-out;
        }
        
        .service-card:hover {
            transform: translateY(-15px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .service-icon {
            font-size: 4em;
            margin-bottom: 25px;
        }
        
        .service-card h5 {
            color: #2196F3;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .doctors-section {
            background: white;
        }
        
        .doctor-spec-card {
            background: linear-gradient(145deg, #2196F3, #21CBF3);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            transition: all 0.3s ease;
            animation: fadeInUp 1s ease-out;
        }
        
        .doctor-spec-card:hover {
            transform: translateY(-10px) scale(1.05);
        }
        
        .doctor-spec-card h6 {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .contact-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .contact-section h3 {
            margin-bottom: 30px;
            font-weight: bold;
        }
        
        .contact-info p, .hours-info p {
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 2.5em;
            }
            
            .hero-buttons .btn {
                width: 100%;
                margin: 10px 0;
            }
            
            .floating-card {
                margin: 20px;
                padding: 20px;
            }
            
            .stat-number {
                font-size: 2.5em;
            }
            
            .service-icon {
                font-size: 3em;
            }
        }
    </style>
</head>
<body ng-app="healthcareApp" ng-controller="MainController">
    <div class="main-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg" ng-show="user">
            <div class="container">
                <a class="navbar-brand" href="#!">üè• HealthCare System</a>
                <div class="navbar-nav ms-auto">
                    <span class="nav-link">Welcome, {{user.name}}</span>
                    <button class="btn btn-outline-light ms-3" ng-click="logout()">Logout</button>
                </div>
            </div>
        </nav>

        <!-- Home Page for Non-logged Users -->
        <div class="container-fluid p-0" ng-show="!user && currentView === 'home'">
            <!-- Hero Section -->
            <div class="hero-section">
                <div class="hero-overlay">
                    <div class="container">
                        <div class="row align-items-center min-vh-100">
                            <div class="col-lg-6">
                                <div class="hero-content">
                                    <h1 class="display-3 fw-bold mb-4">{{facilityInfo.hospital_name || 'MedCare Hospital'}}</h1>
                                    <h4 class="text-light mb-4">{{facilityInfo.tagline || 'Your Health, Our Priority'}}</h4>
                                    <p class="lead mb-5">{{facilityInfo.description || 'Leading healthcare institution providing world-class medical care'}}</p>
                                    <div class="hero-buttons">
                                        <button class="btn btn-primary btn-lg me-3" ng-click="setView('login')">
                                            <i class="fas fa-sign-in-alt me-2"></i>Patient Login
                                        </button>
                                        <button class="btn btn-success btn-lg" ng-click="setView('signup')">
                                            <i class="fas fa-user-plus me-2"></i>Sign Up Today
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="hero-image">
                                    <div class="floating-card">
                                        <h5>üè• Quality Healthcare</h5>
                                        <p>24/7 Emergency Services</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Section -->
            <div class="stats-section py-5">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-3 col-md-6 mb-4" ng-repeat="stat in facilityInfo.stats">
                            <div class="stat-card text-center">
                                <div class="stat-icon">{{stat.icon}}</div>
                                <h2 class="stat-number">{{stat.value}}</h2>
                                <p class="stat-label">{{stat.label}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Section -->
            <div class="services-section py-5">
                <div class="container">
                    <div class="text-center mb-5">
                        <h2 class="section-title">Our Services</h2>
                        <p class="section-subtitle">Comprehensive healthcare solutions for you and your family</p>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-6 mb-4" ng-repeat="service in facilityInfo.services">
                            <div class="service-card">
                                <div class="service-icon">{{service.icon}}</div>
                                <h5>{{service.name}}</h5>
                                <p>{{service.description}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Doctors Section -->
            <div class="doctors-section py-5">
                <div class="container">
                    <div class="text-center mb-5">
                        <h2 class="section-title">Our Expert Doctors</h2>
                        <p class="section-subtitle">Meet our team of experienced healthcare professionals</p>
                    </div>
                    <div class="row">
                        <div class="col-lg-3 col-md-6 mb-4" ng-repeat="spec in facilityInfo.specializations">
                            <div class="doctor-spec-card">
                                <h6>{{spec.name}}</h6>
                                <p>{{spec.doctor}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Section -->
            <div class="contact-section py-5">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-6">
                            <h3>Contact Information</h3>
                            <div class="contact-info">
                                <p><strong>üìç Address:</strong> {{facilityInfo.contact_info.address}}</p>
                                <p><strong>üìû Phone:</strong> {{facilityInfo.contact_info.phone}}</p>
                                <p><strong>üö® Emergency:</strong> {{facilityInfo.contact_info.emergency}}</p>
                                <p><strong>‚úâÔ∏è Email:</strong> {{facilityInfo.contact_info.email}}</p>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <h3>Operating Hours</h3>
                            <div class="hours-info">
                                <p><strong>OPD Hours:</strong> {{facilityInfo.contact_info.hours.opd}}</p>
                                <p><strong>Emergency:</strong> {{facilityInfo.contact_info.hours.emergency}}</p>
                                <p><strong>Pharmacy:</strong> {{facilityInfo.contact_info.hours.pharmacy}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Form -->
        <div class="container" ng-show="!user && currentView === 'login'">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="login-card card">
                        <div class="card-header text-center">
                            <h3>üè• Healthcare Login</h3>
                            <button class="btn btn-link" ng-click="setView('home')">‚Üê Back to Home</button>
                        </div>
                        <div class="card-body">
                            <form ng-submit="login()">
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" ng-model="loginData.email" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Password</label>
                                    <input type="password" class="form-control" ng-model="loginData.password" required>
                                </div>
                                <button type="submit" class="btn btn-primary w-100" ng-disabled="loading">
                                    <span ng-show="loading" class="loading"></span>
                                    Login
                                </button>
                            </form>
                            
                            <div class="mt-4 text-center">
                                <p>Don't have an account? <button class="btn btn-link p-0" ng-click="setView('signup')">Sign up here</button></p>
                            </div>
                            
                            <div class="mt-4">
                                <h6>Demo Credentials:</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <strong>Patient:</strong><br>
                                        Email: arjun.mehta@email.com<br>
                                        Password: pat123
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Doctor:</strong><br>
                                        Email: rajesh.sharma@hospital.com<br>
                                        Password: doc123
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signup Form -->
        <div class="container" ng-show="!user && currentView === 'signup'">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="login-card card">
                        <div class="card-header text-center">
                            <h3>üè• Create Patient Account</h3>
                            <button class="btn btn-link" ng-click="setView('home')">‚Üê Back to Home</button>
                        </div>
                        <div class="card-body">
                            <form ng-submit="signup()">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Full Name *</label>
                                            <input type="text" class="form-control" ng-model="signupData.name" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Email Address *</label>
                                            <input type="email" class="form-control" ng-model="signupData.email" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Password *</label>
                                            <input type="password" class="form-control" ng-model="signupData.password" required minlength="6">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Phone Number *</label>
                                            <input type="tel" class="form-control" ng-model="signupData.phone" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Date of Birth *</label>
                                            <input type="date" class="form-control" ng-model="signupData.date_of_birth" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Blood Group *</label>
                                            <select class="form-control" ng-model="signupData.blood_group" required>
                                                <option value="">Select Blood Group</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Address *</label>
                                    <textarea class="form-control" ng-model="signupData.address" rows="2" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Emergency Contact *</label>
                                    <input type="tel" class="form-control" ng-model="signupData.emergency_contact" required>
                                </div>
                                <button type="submit" class="btn btn-success w-100" ng-disabled="loading">
                                    <span ng-show="loading" class="loading"></span>
                                    Create Account
                                </button>
                            </form>
                            
                            <div class="mt-4 text-center">
                                <p>Already have an account? <button class="btn btn-link p-0" ng-click="setView('login')">Login here</button></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container-fluid p-4" ng-show="user">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Navigation</h5>
                            <div class="list-group list-group-flush">
                                <button class="list-group-item list-group-item-action" 
                                        ng-class="{'active': currentView === 'dashboard'}"
                                        ng-click="setView('dashboard')">
                                    üìä Dashboard
                                </button>
                                <button class="list-group-item list-group-item-action" 
                                        ng-class="{'active': currentView === 'appointments'}"
                                        ng-click="setView('appointments')">
                                    üìÖ Appointments
                                </button>
                                <button class="list-group-item list-group-item-action" 
                                        ng-class="{'active': currentView === 'medical-records'}"
                                        ng-click="setView('medical-records')">
                                    üìã Medical Records
                                </button>
                                <button class="list-group-item list-group-item-action" 
                                        ng-class="{'active': currentView === 'doctors'}"
                                        ng-click="setView('doctors')"
                                        ng-show="user.user_type === 'patient'">
                                    üë®‚Äç‚öïÔ∏è Doctors
                                </button>
                                <button class="list-group-item list-group-item-action" 
                                        ng-class="{'active': currentView === 'patients'}"
                                        ng-click="setView('patients')"
                                        ng-show="user.user_type === 'doctor'">
                                    üè• My Patients
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="col-md-9">
                    <!-- Dashboard -->
                    <div ng-show="currentView === 'dashboard'" class="fade-in">
                        <h2>Dashboard</h2>
                        <div class="row">
                            <div class="col-md-4" ng-show="user.user_type === 'patient'">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h4 class="text-primary">{{appointments.length}}</h4>
                                        <p>Upcoming Appointments</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h4 class="text-success">{{medicalRecords.length}}</h4>
                                        <p>Medical Records</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4" ng-show="user.user_type === 'doctor'">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h4 class="text-info">{{patients.length}}</h4>
                                        <p>Total Patients</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5>Recent Activity</h5>
                                        <div ng-repeat="record in medicalRecords | limitTo:3 | orderBy:'-visit_date'">
                                            <div class="border-bottom py-2">
                                                <strong>{{record.visit_date}}</strong> - {{record.diagnosis}}
                                                <span ng-show="user.user_type === 'patient'"> with {{record.doctor_name}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Appointments -->
                    <div ng-show="currentView === 'appointments'" class="fade-in">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h2>Appointments</h2>
                            <button class="btn btn-primary" ng-click="showBookingForm = !showBookingForm" 
                                    ng-show="user.user_type === 'patient'">
                                + Book Appointment
                            </button>
                        </div>

                        <!-- Booking Form -->
                        <div class="card mb-4" ng-show="showBookingForm && user.user_type === 'patient'">
                            <div class="card-body">
                                <h5>Book New Appointment</h5>
                                <form ng-submit="bookAppointment()">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Doctor</label>
                                            <select class="form-control" ng-model="newAppointment.doctor_id" required>
                                                <option value="">Select Doctor</option>
                                                <option ng-repeat="doctor in doctors" value="{{doctor.id}}">
                                                    {{doctor.name}} - {{doctor.specialization}}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Date</label>
                                            <input type="date" class="form-control" ng-model="newAppointment.date" required>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Time</label>
                                            <select class="form-control" ng-model="newAppointment.time" required>
                                                <option value="">Select Time</option>
                                                <option value="09:00">09:00 AM</option>
                                                <option value="10:00">10:00 AM</option>
                                                <option value="11:00">11:00 AM</option>
                                                <option value="14:00">02:00 PM</option>
                                                <option value="15:00">03:00 PM</option>
                                                <option value="16:00">04:00 PM</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <label class="form-label">Reason for Visit</label>
                                        <textarea class="form-control" ng-model="newAppointment.reason" rows="2" required></textarea>
                                    </div>
                                    <div class="mt-3">
                                        <button type="submit" class="btn btn-success">Book Appointment</button>
                                        <button type="button" class="btn btn-secondary ms-2" ng-click="showBookingForm = false">Cancel</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Time</th>
                                            <th ng-show="user.user_type === 'patient'">Doctor</th>
                                            <th ng-show="user.user_type === 'doctor'">Patient</th>
                                            <th>Reason</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="appointment in appointments | orderBy:'appointment_date'">
                                            <td>{{appointment.appointment_date}}</td>
                                            <td>{{appointment.appointment_time}}</td>
                                            <td ng-show="user.user_type === 'patient'">
                                                {{appointment.doctor_name}}<br>
                                                <small class="text-muted">{{appointment.doctor_specialization}}</small>
                                            </td>
                                            <td ng-show="user.user_type === 'doctor'">{{appointment.patient_name}}</td>
                                            <td>{{appointment.reason}}</td>
                                            <td>
                                                <span class="badge" ng-class="{'badge-success': appointment.status === 'completed', 'badge-info': appointment.status === 'scheduled', 'badge-warning': appointment.status === 'cancelled'}">
                                                    {{appointment.status}}
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Medical Records -->
                    <div ng-show="currentView === 'medical-records'" class="fade-in">
                        <h2>Medical Records</h2>
                        <div class="row">
                            <div class="col-12" ng-repeat="record in medicalRecords | orderBy:'-visit_date'">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <h5 class="card-title">{{record.diagnosis}}</h5>
                                                <h6 class="card-subtitle mb-2 text-muted">
                                                    Date: {{record.visit_date}}
                                                    <span ng-show="user.user_type === 'patient'"> | Doctor: {{record.doctor_name}} ({{record.doctor_specialization}})</span>
                                                </h6>
                                                <p class="card-text">
                                                    <strong>Treatment:</strong> {{record.treatment}}<br>
                                                    <strong>Prescription:</strong> {{record.prescription}}<br>
                                                    <strong>Notes:</strong> {{record.notes}}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Doctors List (Patient View) -->
                    <div ng-show="currentView === 'doctors' && user.user_type === 'patient'" class="fade-in">
                        <h2>Our Doctors</h2>
                        <div class="row">
                            <div class="col-md-6" ng-repeat="doctor in doctors">
                                <div class="card doctor-card mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">{{doctor.name}}</h5>
                                        <h6 class="card-subtitle mb-2 text-primary">{{doctor.specialization}}</h6>
                                        <p class="card-text">
                                            <strong>Qualification:</strong> {{doctor.qualification}}<br>
                                            <strong>Experience:</strong> {{doctor.experience_years}} years<br>
                                            <strong>Phone:</strong> {{doctor.phone}}
                                        </p>
                                        <button class="btn btn-primary btn-sm" ng-click="quickBook(doctor)">Book Appointment</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Patients List (Doctor View) -->
                    <div ng-show="currentView === 'patients' && user.user_type === 'doctor'" class="fade-in">
                        <h2>My Patients</h2>
                        <div class="card">
                            <div class="card-body">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Phone</th>
                                            <th>Blood Group</th>
                                            <th>Last Visit</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="patient in patients">
                                            <td>{{patient.name}}</td>
                                            <td>{{patient.phone}}</td>
                                            <td>{{patient.blood_group}}</td>
                                            <td>{{getLastVisit(patient.id)}}</td>
                                            <td>
                                                <button class="btn btn-info btn-sm" ng-click="viewPatientRecords(patient.id)">View Records</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1050">
        <div class="alert alert-success" ng-show="successMessage" ng-click="successMessage = ''">
            {{successMessage}}
        </div>
        <div class="alert alert-danger" ng-show="errorMessage" ng-click="errorMessage = ''">
            {{errorMessage}}
        </div>
    </div>

    <script>
        angular.module('healthcareApp', [])
        .controller('MainController', ['$scope', '$http', function($scope, $http) {
            // Initialize variables
            $scope.user = null;
            $scope.currentView = 'home'; // Start with home page
            $scope.loginData = {};
            $scope.signupData = {};
            $scope.loading = false;
            $scope.appointments = [];
            $scope.medicalRecords = [];
            $scope.doctors = [];
            $scope.patients = [];
            $scope.facilityInfo = {};
            $scope.showBookingForm = false;
            $scope.newAppointment = {};
            $scope.successMessage = '';
            $scope.errorMessage = '';

            // API Base URL
            const API_BASE = 'http://localhost:8000';

            // HTTP headers with token
            function getHeaders() {
                const token = localStorage.getItem('token');
                return {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'Authorization': token ? `Bearer ${token}` : ''
                };
            }

            // Signup function
            $scope.signup = function() {
                $scope.loading = true;
                $scope.errorMessage = '';
                
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                };
                
                $http.post(API_BASE + '/signup', $scope.signupData, config)
                .then(function(response) {
                    console.log('Signup successful:', response.data);
                    $scope.successMessage = 'Account created successfully! Please login with your credentials.';
                    $scope.signupData = {};
                    // Redirect to login after 2 seconds
                    setTimeout(() => {
                        $scope.$apply(() => {
                            $scope.setView('login');
                            $scope.successMessage = '';
                        });
                    }, 2000);
                })
                .catch(function(error) {
                    console.error('Signup error:', error);
                    $scope.errorMessage = error.data?.detail || 'Registration failed. Please try again.';
                })
                .finally(function() {
                    $scope.loading = false;
                });
            };

            // Login function
            $scope.login = function() {
                $scope.loading = true;
                $scope.errorMessage = '';
                
                // Configure request with proper headers
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                };
                
                $http.post(API_BASE + '/login', $scope.loginData, config)
                .then(function(response) {
                    console.log('Login successful:', response.data);
                    $scope.user = response.data.user;
                    localStorage.setItem('token', response.data.token);
                    localStorage.setItem('user', JSON.stringify(response.data.user));
                    $scope.loadData();
                    $scope.successMessage = 'Login successful!';
                })
                .catch(function(error) {
                    console.error('Login error:', error);
                    $scope.errorMessage = error.data?.detail || 'Invalid credentials. Please try again.';
                })
                .finally(function() {
                    $scope.loading = false;
                });
            };

            // Logout function
            $scope.logout = function() {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                $scope.user = null;
                $scope.currentView = 'home'; // Go back to home page
                $scope.successMessage = 'Logged out successfully!';
            };

            // Check if user is already logged in
            function checkLogin() {
                const savedUser = localStorage.getItem('user');
                const token = localStorage.getItem('token');
                if (savedUser && token) {
                    $scope.user = JSON.parse(savedUser);
                    $scope.currentView = 'dashboard'; // Go to dashboard if logged in
                    $scope.loadData();
                } else {
                    // Load facility info for home page
                    $scope.loadFacilityInfo();
                }
            }

            // Initialize default facility info
            function initializeFacilityInfo() {
                $scope.facilityInfo = {
                    hospital_name: "MedCare Hospital & Research Center",
                    tagline: "Your Health, Our Priority",
                    description: "A leading healthcare institution committed to providing world-class medical care with cutting-edge technology and compassionate service.",
                    services: [
                        {
                            name: "Emergency Care",
                            description: "24/7 emergency medical services with state-of-the-art trauma center",
                            icon: "üöë"
                        },
                        {
                            name: "Specialized Treatments",
                            description: "Expert care in Cardiology, Pediatrics, Orthopedics, and Gynecology",
                            icon: "üè•"
                        },
                        {
                            name: "Diagnostic Services",
                            description: "Advanced imaging, laboratory tests, and health screenings",
                            icon: "üî¨"
                        },
                        {
                            name: "Telemedicine",
                            description: "Virtual consultations and remote patient monitoring",
                            icon: "üíª"
                        },
                        {
                            name: "Pharmacy Services",
                            description: "Complete pharmaceutical care and medication management",
                            icon: "üíä"
                        },
                        {
                            name: "Wellness Programs",
                            description: "Preventive care, health education, and lifestyle counseling",
                            icon: "üåü"
                        }
                    ],
                    stats: [
                        {label: "Years of Excellence", value: "25+", icon: "‚≠ê"},
                        {label: "Expert Doctors", value: "50+", icon: "üë®‚Äç‚öïÔ∏è"},
                        {label: "Patients Served", value: "100K+", icon: "üë•"},
                        {label: "Success Rate", value: "98%", icon: "üìà"}
                    ],
                    contact_info: {
                        address: "123 Health Street, Medical District, Mumbai, Maharashtra 400001",
                        phone: "+91-22-2345-6789",
                        emergency: "+91-22-2345-6790",
                        email: "info@medcare.com",
                        hours: {
                            opd: "8:00 AM - 8:00 PM",
                            emergency: "24/7",
                            pharmacy: "24/7"
                        }
                    },
                    specializations: [
                        {name: "Cardiology", doctor: "Dr. Rajesh Sharma"},
                        {name: "Pediatrics", doctor: "Dr. Priya Patel"},
                        {name: "Orthopedics", doctor: "Dr. Amit Kumar"},
                        {name: "Gynecology", doctor: "Dr. Sunita Rao"}
                    ]
                };
            }

            // Load facility information
            $scope.loadFacilityInfo = function() {
                // Try to load from backend, but don't worry if it fails
                $http.get(API_BASE + '/facility-info')
                .then(function(response) {
                    $scope.facilityInfo = response.data;
                })
                .catch(function(error) {
                    console.log('Using default facility info (backend endpoint not available)');
                    // Facility info is already set by initializeFacilityInfo()
                });
            };

            // Load data based on user type
            $scope.loadData = function() {
                $scope.loadAppointments();
                $scope.loadMedicalRecords();
                $scope.loadDoctors();
                if ($scope.user.user_type === 'doctor') {
                    $scope.loadPatients();
                }
            };

            // Load appointments
            $scope.loadAppointments = function() {
                $http.get(API_BASE + '/appointments', { headers: getHeaders() })
                .then(function(response) {
                    $scope.appointments = response.data;
                });
            };

            // Load medical records
            $scope.loadMedicalRecords = function() {
                if ($scope.user.user_type === 'patient') {
                    $http.get(API_BASE + '/medical-records/' + $scope.user.id, { headers: getHeaders() })
                    .then(function(response) {
                        $scope.medicalRecords = response.data;
                    });
                } else if ($scope.user.user_type === 'doctor') {
                    // For doctors, load all their patients' records
                    $scope.loadPatients().then(() => {
                        let allRecords = [];
                        let promises = [];
                        
                        $scope.patients.forEach(patient => {
                            let promise = $http.get(API_BASE + '/medical-records/' + patient.id, { headers: getHeaders() })
                            .then(function(response) {
                                allRecords = allRecords.concat(response.data);
                            });
                            promises.push(promise);
                        });
                        
                        Promise.all(promises).then(() => {
                            $scope.medicalRecords = allRecords;
                            $scope.$apply();
                        });
                    });
                }
            };

            // Load doctors
            $scope.loadDoctors = function() {
                $http.get(API_BASE + '/doctors')
                .then(function(response) {
                    $scope.doctors = response.data;
                });
            };

            // Load patients (for doctors)
            $scope.loadPatients = function() {
                if ($scope.user.user_type === 'doctor') {
                    return $http.get(API_BASE + '/doctor-patients/' + $scope.user.id, { headers: getHeaders() })
                    .then(function(response) {
                        $scope.patients = response.data;
                        return response.data;
                    });
                }
                return Promise.resolve([]);
            };

            // Set current view
            $scope.setView = function(view) {
                $scope.currentView = view;
                $scope.showBookingForm = false;
                $scope.errorMessage = '';
                $scope.successMessage = '';
                
                // Load facility info when going to home
                if (view === 'home' && !$scope.user) {
                    $scope.loadFacilityInfo();
                }
                
                // Redirect to dashboard if logged in user tries to access login/signup
                if ($scope.user && (view === 'login' || view === 'signup' || view === 'home')) {
                    $scope.currentView = 'dashboard';
                }
            };

            // Book appointment
            $scope.bookAppointment = function() {
                const appointmentData = {
                    patient_id: $scope.user.id,
                    doctor_id: $scope.newAppointment.doctor_id,
                    appointment_date: $scope.newAppointment.date,
                    appointment_time: $scope.newAppointment.time,
                    reason: $scope.newAppointment.reason
                };

                $http.post(API_BASE + '/appointments', appointmentData, { headers: getHeaders() })
                .then(function(response) {
                    $scope.successMessage = 'Appointment booked successfully!';
                    $scope.loadAppointments();
                    $scope.showBookingForm = false;
                    $scope.newAppointment = {};
                })
                .catch(function(error) {
                    $scope.errorMessage = 'Failed to book appointment. Please try again.';
                });
            };

            // Quick book from doctor card
            $scope.quickBook = function(doctor) {
                $scope.newAppointment.doctor_id = doctor.id;
                $scope.showBookingForm = true;
                $scope.setView('appointments');
            };

            // View patient records (for doctors)
            $scope.viewPatientRecords = function(patientId) {
                $http.get(API_BASE + '/medical-records/' + patientId, { headers: getHeaders() })
                .then(function(response) {
                    $scope.medicalRecords = response.data;
                    $scope.setView('medical-records');
                });
            };

            // Get last visit date for patient
            $scope.getLastVisit = function(patientId) {
                const patientRecords = $scope.medicalRecords.filter(r => r.patient_id === patientId);
                if (patientRecords.length > 0) {
                    const lastRecord = patientRecords.sort((a, b) => new Date(b.visit_date) - new Date(a.visit_date))[0];
                    return lastRecord.visit_date;
                }
                return 'No visits';
            };

            // Auto-hide messages after 5 seconds
            $scope.$watch('successMessage', function(newVal) {
                if (newVal) {
                    setTimeout(() => {
                        $scope.$apply(() => { $scope.successMessage = ''; });
                    }, 5000);
                }
            });

            $scope.$watch('errorMessage', function(newVal) {
                if (newVal) {
                    setTimeout(() => {
                        $scope.$apply(() => { $scope.errorMessage = ''; });
                    }, 5000);
                }
            });

            // Initialize app
            initializeFacilityInfo(); // Set default facility info immediately
            checkLogin();
        }]);
    </script>
</body>
</html>